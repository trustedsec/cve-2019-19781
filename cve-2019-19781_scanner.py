#!/usr/bin/env python3
#
# Single check to see if the server is still vulnerable to CVE-2019-19781
# Written by: Dave Kennedy
# Company: TrustedSec
#
import requests
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) # disable warnings
import argparse

def check_server(target, targetport):
    req = requests.get("https://%s:%s/vpn/../vpns/cfg/smb.conf" % (target,targetport), verify=False)
    if ("global") in req.content: # each smb.conf will contain a [global] variable
        print("[\033[91m!\033[0m] This Citrix ADC Server: %s is still vulnerable to CVE-2019-19781." % (target))
    else:
        print("[\033[92m*\033[0m] Awesome! The server %s is not vulnerable." % (target))

print("""
   _______      ________    ___   ___  __  ___        __  ___ ______ ___  __ 
  / ____\ \    / /  ____|  |__ \ / _ \/_ |/ _ \      /_ |/ _ \____  / _ \/_ |
 | |     \ \  / /| |__ ______ ) | | | || | (_) |______| | (_) |  / / (_) || |
 | |      \ \/ / |  __|______/ /| | | || |\__, |______| |\__, | / / > _ < | |
 | |____   \  /  | |____    / /_| |_| || |  / /       | |  / / / / | (_) || |
  \_____|   \/   |______|  |____|\___/ |_| /_/        |_| /_/ /_/   \___/ |_|
     

CVE-2019-19781-Scanner

Company: TrustedSec
Written by: Dave Kennedy

This will look to see if the remote system is still vulnerable to CVE-2019-19781. This 
will only scan one host at a time.

Usage: python3 cve-2019-19781_scanner.py targetip targetport
""")

# parse our commands
parser = argparse.ArgumentParser()
parser.add_argument("target", help="the vulnerable server with Citrix (defaults https)")
parser.add_argument("targetport", help="the target server web port (normally on 443)")
args = parser.parse_args()

# run the check
check_server(args.target, args.targetport)
